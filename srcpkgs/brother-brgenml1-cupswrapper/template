# Template file for 'brother-brgenml1-cupswrapper'
pkgname=brother-brgenml1-cupswrapper
version=3.1.0
revision=1
archs="i686 x86_64"
create_wrksrc=yes
hostmakedepends="rpmextract"
makedepends="cups"
depends="brother-brgenml1-lpr cups cups-filters"
short_desc="CUPS wrapper driver for the brother BrGenML1 printer/scanner"
maintainer="El Christianito <el-christianito@mail.ch>"
license="GPL-2.0"
homepage="http://support.brother.com/g/b/index.aspx"
distfiles="https://download.brother.com/welcome/dlf101126/brgenml1cupswrapper-${version}-1.i386.rpm"
checksum="397cb2d91e0748f4c0498d831647efbc62af9e02f576ad52dc520bcac876f795"
nopie=yes
patch_args="-Np1"
_brotherdrivername="BrGenML1"

if [ "$XBPS_TARGET_MACHINE" = "x86_64" ]; then
	depends+=" glibc-32bit libusb-32bit libusb-compat-32bit"
fi

do_extract() {
	rpmextract ${XBPS_SRCDISTDIR}/${pkgname}-${version}/brgenml1cupswrapper-${version}-1.i386.rpm
}

do_install() {
    vmkdir opt/brother/Printers/ 755
    vcopy opt/brother/Printers/* opt/brother/Printers

    vmkdir usr/share/cups/model/ 755
    ln -s /opt/brother/Printers/${_brotherdrivername}/cupswrapper/brother-${_brotherdrivername}-cups-en.ppd ${DESTDIR}/usr/share/cups/model/brother-${_brotherdrivername}-cups-en.ppd
    
    vmkdir usr/lib/cups/filter/ 755
    ln -s /opt/brother/Printers/${_brotherdrivername}/cupswrapper/brother_lpdwrapper_${_brotherdrivername} ${DESTDIR}/usr/lib/cups/filter/brother_lpdwrapper_${_brotherdrivername}
}