# Template file for 'brother-brgenml1-lpr'
pkgname=brother-brgenml1-lpr
version=3.1.0
revision=1
archs="i686 x86_64"
create_wrksrc=yes
hostmakedepends="rpmextract"
depends="a2ps ghostscript"
short_desc="LPR driver for the brother BrGenML1 printer/scanner"
maintainer="El Christianito <el-christianito@mail.ch"
license="custom:Proprietary"
homepage="http://support.brother.com/g/b/index.aspx"
distfiles="https://download.brother.com/welcome/dlf101124/brgenml1lpr-${version}-1.i386.rpm"
checksum="18823eb345e4e4391d7a6a3a1d442a96b2224e12a0600542f0d3d700cf158706"
nopie=yes
system_accounts="lp"
_brotherdrivername="BrGenML1"

if [ "$XBPS_TARGET_MACHINE" = "x86_64" ]; then
	depends+=" glibc-32bit libusb-32bit libusb-compat-32bit"
fi

do_extract() {
	rpmextract ${XBPS_SRCDISTDIR}/${pkgname}-${version}/brgenml1lpr-${version}-1.i386.rpm
}

do_install() {
    vmkdir opt/brother/Printers 755
    vcopy opt/brother/Printers/* opt/brother/Printers

    vmkdir etc/opt/brother/Printers/${_brotherdrivername}/inf 755
    ln -s /opt/brother/Printers/${_brotherdrivername}/inf/br${_brotherdrivername}rc ${DESTDIR}/etc/opt/brother/Printers/${_brotherdrivername}/inf/br${_brotherdrivername}rc
        
    vmkdir usr/lib/cups/filter 755
    ln -s /opt/brother/Printers/${_brotherdrivername}/lpd/filter_${_brotherdrivername} ${DESTDIR}/usr/lib/cups/filter/filter_${_brotherdrivername}

    vbin ${FILESDIR}/brprintconflsr3_BrGenML1
}